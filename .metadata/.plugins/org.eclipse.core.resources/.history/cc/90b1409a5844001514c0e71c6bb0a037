/*
 *
 *  Created on: Aug 12, 2015
 *      Author: Deepak K. Gupta
 *  
 */

#include <atop/fem/output.h>
#include <deal.II/dofs/dof_handler.h>
#include <deal.II/numerics/vector_tools.h>
#include <deal.II/numerics/data_out.h>
#include <string>
#include <fstream>

using namespace atop;
using namespace dealii;


template <int dim>
void OutputData<dim>::write_fe_solution(
		std::string &filename,
		DoFHandler<dim> &dof_handler,
		Vector<double> &solution,
		std::vector<std::string> &solution_names
		){

	std::ofstream output(filename.c_str());
	DataOut<dim> data_out;
	data_out.attach_dof_handler(dof_handler);

	data_out.add_data_vector(solution, solution_names);
	data_out.build_patches();
	data_out.write_vtk(output);
}

template <int dim>
void OutputData<dim>::write_a_solution(
		std::string &filename,
		DoFHandler<dim> &dof_handler,
		Vector<double> &solution,
		Vector<double> &nodal_density
		){

	std::ofstream output(filename.c_str());
	DataOut<dim> data_out;
	data_out.attach_dof_handler(dof_handler);

	std::vector<std::string> solution_names;
	switch(dim){
	case 1:
		solution_names.push_back("displacement");
		break;
	case 2:
		solution_names.push_back("x_displacement");
		solution_names.push_back("y_displacement");
		break;
	case 3:
		solution_names.push_back("x_displacement");
		solution_names.push_back("y_displacement");
		solution_names.push_back("z_displacement");
		break;
	default:
		Assert(false, ExcNotImplemented);
	}

	data_out.add_data_vector(solution, solution_names);
	data_out.add_data_vector(nodal_density, "Density");
	data_out.build_patches();
	data_out.write_vtk(output);
}


